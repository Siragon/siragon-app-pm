<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SÃ­ragon Project Manager</title>
 		<link rel="stylesheet/less" href="less/bootstrap.less" />

		<script>
		  less = {
			env: "development",
			logLevel: 2,
			async: false,
			fileAsync: false,
			poll: 1000,
			functions: {},
			dumpLineNumbers: "comments",
			relativeUrls: false,
			rootpath: ":/a.com/"
		  };
		</script>
		<script src="js/less-1.6.2.js"></script>
<style>* {
  box-sizing: border-box;
  margin: 0;
 -webkit-user-select: none;
        cursor: default;
}
body {
  background: linear-gradient(45deg, #539fa2 0%, #72b1a4 33%, #c4dbb4 67%, #abccb1), linear-gradient(125deg, #539fa2 0%, #72b1a4 33%, #c4dbb4 67%, #abccb1);
  min-height: 100vh;
}
</style>
<script >
var gui = require('nw.gui');
var win = gui.Window.get();
    
    if(localStorage.org==''){
        login();
    }else{
        window.onload = function(){
            run();
        }
    }
    
    function login(){
        win.hide();
        var popWindow = gui.Window.open('login.html',
                                        {width: 400, height: 550, toolbar: false, show: false, icon: "img/user.png", position: "center"});
        popWindow.on('close', function() {
            //var image = popWindow.window.document.getElementById('image');
           this.close(true);
            if(localStorage.org==''){
                //win.close(true);
                gui.App.quit();
            }else{
                run();
            }
        });
    }
    
    function run(){
        //issues(11,22,33,44);
        $(document).keypress(function(e){
            console.log(e.which);
            switch(e.which)
            {
                // user presses the "F5"
                case 116: win.reloadIgnoringCache(); break;
                // user presses the "F1"   
                case 112: win.showDevTools(); break;
            }
        });
        win.show();
    }

function issues(errorMsg, url, lineNumber, BuildLabEx) {
    var data = {
        "title": "Sent from the customer",
        "body": errorMsg + "\n**Line**: " + lineNumber + "\n**ChromePath**: " + url + "\n**BuildLabEx**: " + BuildLabEx,
        "assignee": "alexsalas",
        "labels": ["bug"]
    };
    _request("POST", "/repos/siragon/aosu/issues", data, null);
}

    
    
function _request(method, path, data, raw) {
    var API_URL = 'https://api.github.com';

    function getURL() {
        var url = API_URL + path;
        return url + ((/\?/).test(url) ? "&" : "?") + (new Date()).getTime();
    }
    var xhr = new XMLHttpRequest();
    if (!raw) {
        xhr.dataType = "json";
    }
    xhr.open(method, getURL());
    xhr.onreadystatechange = function () {
        if (this.readyState == 4) {
            if (this.status >= 200 && this.status < 300 || this.status === 304) {
                console.log(null, raw ? this.responseText : this.responseText ? JSON.parse(this.responseText) : true);
                console.log(this.responseText);
            } else {
                console.log({request: this, error: this.status});
                console.log(this.responseText);
                var out = JSON.parse(this.responseText);
                if(out.message == "Bad credentials"){
                    login();
                }
            }
        }
    };
    xhr.setRequestHeader('Accept', 'application/vnd.github.raw');
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.setRequestHeader('Authorization', 'Token ' + localStorage.token);
    data ? xhr.send(JSON.stringify(data)) : xhr.send();
}
</script>
</head>
  <body>
    <h1>Hello, world!</h1>

		<script src="js/jquery-2.1.0.js"></script>
		<script src="js/bootstrap-3.1.0.js"></script>
</body>
</html>